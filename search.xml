<?xml version="1.0" encoding="utf-8"?>
<search>
  
    
    <entry>
      <title><![CDATA[å…³äºŽRunLoopçš„ç¬”è®°]]></title>
      <url>%2F2018%2F04%2F01%2F%E5%85%B3%E4%BA%8ERunLoop%E7%9A%84%E7%AC%94%E8%AE%B0%2F</url>
      <content type="text"><![CDATA[å…³äºŽ RunLoop ç¬”è®°ðŸ“’RunLoopRunLoopå®žé™…ä¸Šæ˜¯ä¸ªå¯¹è±¡ï¼Œåœ¨å¾ªçŽ¯ä¸­ç”¨æ¥å¤„ç†ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å‡ºçŽ°çš„å„ç§äº‹æƒ…ï¼ˆæ¯”å¦‚è§¦æ‘¸ã€UIåˆ·æ–°ã€timerã€selectorï¼‰ï¼Œä»Žè€Œä¿æŒç¨‹åºæŒç»­è¿è¡Œï¼›è€Œä¸”åœ¨æ²¡æœ‰äº‹ä»¶å¤„ç†çš„çŠ¶æ€ä¸‹ï¼Œä¼šè¿›å…¥ç¡çœ æ¨¡å¼ï¼ŒèŠ‚çœCPUæ¶ˆè€—ï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚ iOSå¼€å‘ä¸­æä¾›NSRunLoop &amp; CFRunloopRefï¼› CFRunLoopRef æ˜¯åœ¨ CoreFoundation æ¡†æž¶å†…çš„ï¼Œå®ƒæä¾›äº†çº¯ C å‡½æ•°çš„ APIï¼Œæ‰€æœ‰è¿™äº› API éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ NSRunLoop æ˜¯åŸºäºŽ CFRunLoopRef çš„å°è£…ï¼Œæä¾›äº†é¢å‘å¯¹è±¡çš„ APIï¼Œä½†æ˜¯è¿™äº› API ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ RunLoop ä¸Žçº¿ç¨‹çš„å…³ç³»RunLoopæ˜¯åŸºäºŽçº¿ç¨‹pthreadç®¡ç†ï¼Œpthreadå’ŒRunLoopä¹‹é—´æ˜¯ä¸€ä¸€å¯¹åº”ï¼Œå…¶å…³ç³»æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å­—å…¸é‡Œã€‚åˆšåˆ›å»ºçº¿ç¨‹æ˜¯ä¸ä¼šæœ‰RunLoopï¼Œåªæœ‰ç¬¬ä¸€æ¬¡èŽ·å–RunLoopçš„æ—¶å€™ä¼šåˆ›å»ºRunLoopï¼ŒåŒæ—¶åœ¨çº¿ç¨‹ç»“æŸçš„æ—¶å€™ä¼šé”€æ¯å¯¹åº”çš„RunLoopã€‚ CFRunLoopRefRunLoop Mode CFRunLoopRef CFRunLoopModeRef CFRunLoopSourceRef CFRunLoopTimerRef CFRunLoopObserverRef ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¦‚å›¾ï¼š ä¸€ä¸ª RunLoop åŒ…å«è‹¥å¹²ä¸ª Modeï¼Œæ¯ä¸ª Mode åˆåŒ…å«è‹¥å¹²ä¸ª Source/Timer/Observerã€‚æ¯æ¬¡è°ƒç”¨ RunLoop çš„ä¸»å‡½æ•°æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª Modeï¼Œè¿™ä¸ªModeè¢«ç§°ä½œ CurrentModeã€‚å¦‚æžœéœ€è¦åˆ‡æ¢ Modeï¼Œåªèƒ½é€€å‡º Loopï¼Œå†é‡æ–°æŒ‡å®šä¸€ä¸ª Mode è¿›å…¥ã€‚è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒç»„çš„ Source/Timer/Observerï¼Œè®©å…¶äº’ä¸å½±å“. ç³»ç»Ÿé»˜è®¤æä¾›ï¼š kCFRunLoopDefaultMode(NSDefaultRunLoopMode) ç³»ç»Ÿé»˜è®¤çš„modeï¼Œä¸åšä»»ä½•æ“ä½œå°±åœ¨è¯¥modeä¸­ã€‚ UITrackingRunLoopMode æ»‘åŠ¨UIScrollViewçš„æ—¶å€™ï¼Œåˆ‡æ¢æˆè¯¥modeã€‚ è‡³äºŽ kCFRunLoopCommonModesï¼ˆNSRunLoopCommonModesï¼‰ï¼Œå¹¶ä¸æ˜¯å…·ä½“æŸä¸ªmodeï¼Œè€Œæ˜¯ä¸ªmodeç»„åˆæ¨¡å¼ï¼Œé»˜è®¤åŒ…å«å‰ä¸¤è€…modeã€‚è‡ªå®šä¹‰çš„modeå¯ä»¥é€šè¿‡CFRunLoopAddCommonMode()æ·»åŠ åˆ°kCFRunLoopCommonModesä¸­ã€‚ SourceCFRunLoopSourceRef æ˜¯äº‹ä»¶äº§ç”Ÿçš„åœ°æ–¹ã€‚Sourceæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šSource0 å’Œ Source1ã€‚ Source0 åªåŒ…å«äº†ä¸€ä¸ªå›žè°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå®ƒå¹¶ä¸èƒ½ä¸»åŠ¨è§¦å‘äº‹ä»¶ã€‚ä½¿ç”¨æ—¶ï¼Œä½ éœ€è¦å…ˆè°ƒç”¨ CFRunLoopSourceSignal(source)ï¼Œå°†è¿™ä¸ª Source æ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œç„¶åŽæ‰‹åŠ¨è°ƒç”¨ CFRunLoopWakeUp(runloop) æ¥å”¤é†’ RunLoopï¼Œè®©å…¶å¤„ç†è¿™ä¸ªäº‹ä»¶ã€‚ Source1 åŒ…å«äº†ä¸€ä¸ª mach_port å’Œä¸€ä¸ªå›žè°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œè¢«ç”¨äºŽé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹ç›¸äº’å‘é€æ¶ˆæ¯ã€‚è¿™ç§ Source èƒ½ä¸»åŠ¨å”¤é†’ RunLoop çš„çº¿ç¨‹ï¼Œå…¶åŽŸç†åœ¨ä¸‹é¢ä¼šè®²åˆ°ã€‚ CFRunLoopTimerRef æ˜¯åŸºäºŽæ—¶é—´çš„è§¦å‘å™¨ï¼Œå®ƒå’Œ NSTimer æ˜¯toll-free bridged çš„ï¼Œå¯ä»¥æ··ç”¨ã€‚å…¶åŒ…å«ä¸€ä¸ªæ—¶é—´é•¿åº¦å’Œä¸€ä¸ªå›žè°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ã€‚å½“å…¶åŠ å…¥åˆ° RunLoop æ—¶ï¼ŒRunLoopä¼šæ³¨å†Œå¯¹åº”çš„æ—¶é—´ç‚¹ï¼Œå½“æ—¶é—´ç‚¹åˆ°æ—¶ï¼ŒRunLoopä¼šè¢«å”¤é†’ä»¥æ‰§è¡Œé‚£ä¸ªå›žè°ƒã€‚ ObserverCFRunLoopObserverRef æ˜¯è§‚å¯Ÿè€…ï¼Œæ¯ä¸ª Observer éƒ½åŒ…å«äº†ä¸€ä¸ªå›žè°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå½“ RunLoop çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§‚å¯Ÿè€…å°±èƒ½é€šè¿‡å›žè°ƒæŽ¥å—åˆ°è¿™ä¸ªå˜åŒ–ã€‚å¯ä»¥è§‚æµ‹çš„æ—¶é—´ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š 123456789/* Run Loop Observer Activities */typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), // è¿›å…¥RunLoop kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), // å³å°†å¼€å§‹Timerå¤„ç† kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // å³å°†å¼€å§‹Sourceå¤„ç† kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), // å³å°†è¿›å…¥ä¼‘çœ  kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), //ä»Žä¼‘çœ çŠ¶æ€å”¤é†’ kCFRunLoopExit = (1UL &lt;&lt; 7), //é€€å‡ºRunLoop&#125;; RunLoop çš„å†…éƒ¨é€»è¾‘å®žé™…ä¸Š RunLoop å°±æ˜¯è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œå…¶å†…éƒ¨æ˜¯ä¸€ä¸ª do-while å¾ªçŽ¯ã€‚å½“ä½ è°ƒç”¨ CFRunLoopRun() æ—¶ï¼Œçº¿ç¨‹å°±ä¼šä¸€ç›´åœç•™åœ¨è¿™ä¸ªå¾ªçŽ¯é‡Œï¼›ç›´åˆ°è¶…æ—¶æˆ–è¢«æ‰‹åŠ¨åœæ­¢ï¼Œè¯¥å‡½æ•°æ‰ä¼šè¿”å›žã€‚ RunLoopçš„åº”ç”¨NSTimerNSTimerçš„åˆ›å»ºé€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ï¼Œéƒ½æ˜¯ç±»æ–¹æ³•ï¼š timeWithXXX scheduedTimerWithXXXäºŒè€…æœ€å¤§çš„åŒºåˆ«æ˜¯åŽè€…åˆ›å»ºtimerä¼šè‡ªåŠ¨ä»¥NSDefaultRunLoopMode modeæ·»åŠ åˆ°å½“å‰çº¿ç¨‹RunLoopä¸­ï¼Œä¸æ·»åŠ åˆ°RunLoopä¸­æ˜¯æ— æ³•æ­£å¸¸å·¥ä½œçš„ã€‚NSTimer &amp; å†…å­˜ç®¡ç† 123456789101112131415161718192021222324252627282930313233343536373839404142434445import "ViewController1.h"@interface ViewController1 ()@property (nonatomic,weak) NSTimer *timer1;@property (nonatomic,weak) NSTimer *timer2;@end@implementation ViewController1- (void)viewDidLoad &#123;[super viewDidLoad];// timer1åˆ›å»ºåŽä¼šè‡ªåŠ¨ä»¥NSDefaultRunLoopModeé»˜è®¤æ¨¡å¼æ·»åŠ åˆ°å½“å‰RunLoopä¸­ï¼Œæ‰€ä»¥å¯ä»¥æ­£å¸¸å·¥ä½œself.timer1 = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self selector:@selector(timeInterval:) userInfo:nil repeats:YES];NSTimer *tempTimer = [NSTimer timerWithTimeInterval:1.0 target:self selector:@selector(timeInterval:) userInfo:nil repeats:YES];// å¦‚æžœä¸æŠŠtimer2æ·»åŠ åˆ°RunLoopä¸­æ˜¯æ— æ³•æ­£å¸¸å·¥ä½œçš„(æ³¨æ„å¦‚æžœæƒ³è¦åœ¨æ»šåŠ¨UIScrollViewæ—¶timer2å¯ä»¥æ­£å¸¸å·¥ä½œå¯ä»¥å°†NSDefaultRunLoopModeæ”¹ä¸ºNSRunLoopCommonModes)[[NSRunLoop currentRunLoop] addTimer:tempTimer forMode:NSDefaultRunLoopMode];self.timer2 = tempTimer; CGRect rect = [UIScreen mainScreen].bounds;UIScrollView *scrollView = [[UIScrollView alloc] initWithFrame:CGRectInset(rect, 0, 200)];[self.view addSubview:scrollView];UIView *contentView = [[UIView alloc] initWithFrame:CGRectInset(scrollView.bounds, -100, -100)];contentView.backgroundColor = [UIColor redColor];[scrollView addSubview:contentView];scrollView.contentSize = contentView.frame.size;&#125;- (void)timeInterval:(NSTimer *)timer &#123; if (self.timer1 == timer) &#123;NSLog(@"timer1..."); &#125; else &#123;NSLog(@"timer2..."); &#125;&#125;- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; [self dismissViewControllerAnimated:true completion:nil];&#125;- (void)dealloc &#123;NSLog(@"ViewController1 dealloc...");&#125;@end ä¸Šè¿°ä»£ç ä¸­å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼šViewController å’Œ timer å‡æ— æ³•é‡Šæ”¾ã€‚ViewControlleræ— æ³•é‡Šæ”¾çš„åŽŸå› æ˜¯ï¼šåˆ›å»ºtimerçš„æ—¶å€™NStimerçš„targetæŒ‡å®šselfï¼ˆå³ViewControllerï¼‰ï¼Œè¿™æ ·timerå¯¹ViewControlleræœ‰äº†ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚è§£å†³çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼ŒåŸºæœ¬æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å¯¹targetè¿›è¡Œè½¬ç§»ï¼š å°†targetåˆ†ç¦»å‡ºæ¥ç‹¬ç«‹æˆä¸€ä¸ªå¯¹è±¡ï¼ˆåœ¨è¿™ä¸ªå¯¹è±¡ä¸­åˆ›å»ºNSTimerå¹¶å°†å¯¹è±¡æœ¬èº«ä½œä¸ºNSTimerçš„targetï¼‰ï¼ŒViewControlleré€šè¿‡è¿™ä¸ªå¯¹è±¡é—´æŽ¥ä½¿ç”¨NSTimerï¼› ç›´æŽ¥å¢žåŠ NSTimeræ‰©å±•ï¼ˆcategoryï¼‰ï¼Œè®©NSTimerè‡ªèº«åšä¸ºtargetï¼ŒåŒæ—¶å¯ä»¥å°†æ“ä½œselectorå°è£…åˆ°blockä¸­ã€‚åŽè€…ç›¸å¯¹ä¼˜é›…ï¼Œä¹Ÿæ˜¯ç›®å‰ä½¿ç”¨è¾ƒå¤šçš„æ–¹æ¡ˆï¼ˆç›®å‰æœ‰å¤§é‡ç±»ä¼¼çš„å°è£…ï¼Œä¾‹å¦‚ï¼šNSTimer+Blockï¼‰ã€‚æ˜¾ç„¶Appleä¹Ÿè®¤è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æžœä½ å¯ä»¥ç¡®ä¿ä»£ç åªåœ¨iOS 10ä¸‹è¿è¡Œå°±å¯ä»¥ä½¿ç”¨iOS 10æ–°å¢žçš„ç³»ç»Ÿçº§blockæ–¹æ¡ˆï¼‰ã€‚è‡³äºŽtimeræ— æ³•é‡Šæ”¾çš„åŽŸå› æ˜¯ï¼šä¸ºäº†ç¡®ä¿å®šæ—¶å™¨æ­£å¸¸è¿è½¬ï¼Œå½“åŠ å…¥åˆ°RunLoopä»¥åŽç³»ç»Ÿä¼šå¯¹NSTimeræ‰§è¡Œä¸€æ¬¡retainæ“ä½œã€‚è§£å†³çš„æ–¹æ³•æ˜¯ï¼šåœ¨deallocæ–¹æ³•ä¸­è°ƒç”¨NSTimerçš„invalidateæ–¹æ³•å°±è¡Œã€‚UIæ›´æ–°å½“åœ¨æ“ä½œ UI æ—¶ï¼Œæ¯”å¦‚æ”¹å˜äº† Frameã€æ›´æ–°äº† UIView/CALayer çš„å±‚æ¬¡æ—¶ï¼Œæˆ–è€…æ‰‹åŠ¨è°ƒç”¨äº† UIView/CALayer çš„ setNeedsLayout/setNeedsDisplayæ–¹æ³•åŽï¼Œè¿™ä¸ª UIView/CALayer å°±è¢«æ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œå¹¶è¢«æäº¤åˆ°ä¸€ä¸ªå…¨å±€çš„å®¹å™¨åŽ»ã€‚è‹¹æžœæ³¨å†Œäº†ä¸€ä¸ª Observer ç›‘å¬ BeforeWaiting(å³å°†è¿›å…¥ä¼‘çœ ) å’Œ Exit (å³å°†é€€å‡ºLoop) äº‹ä»¶ï¼Œå›žè°ƒåŽ»æ‰§è¡Œä¸€ä¸ªå¾ˆé•¿çš„å‡½æ•°ï¼š\_ZN2CA11Transaction17observer\_callbackEP19\_\_CFRunLoopObservermPv()ã€‚è¿™ä¸ªå‡½æ•°é‡Œä¼šéåŽ†æ‰€æœ‰å¾…å¤„ç†çš„ UIView/CAlayer ä»¥æ‰§è¡Œå®žé™…çš„ç»˜åˆ¶å’Œè°ƒæ•´ï¼Œå¹¶æ›´æ–° UI ç•Œé¢ã€‚ é˜…è¯»æ–‡ç« ï¼šiOSåˆ¨æ ¹é—®åº•-æ·±å…¥ç†è§£RunLoopæ·±å…¥ç†è§£RunLoop]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[è¯»ã€Šç¼–ç¨‹çš„æ™ºæ…§ã€‹çš„ç¬”è®°]]></title>
      <url>%2F2017%2F05%2F23%2F%E8%AF%BB%E3%80%8A%E7%BC%96%E7%A8%8B%E7%9A%84%E6%99%BA%E6%85%A7%E3%80%8B%E7%9A%84%E7%AC%94%E8%AE%B0%2F</url>
      <content type="text"><![CDATA[åå¤æŽ¨æ•²ä»£ç æé«˜ç¼–ç¨‹æ°´å¹³æœ€æœ‰æ•ˆçš„åŠžæ³•æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘æƒ³äº†å¾ˆä¹…ï¼Œç»ˆäºŽå‘çŽ°æœ€æœ‰æ•ˆçš„åŠžæ³•ï¼Œå…¶å®žæ˜¯ååå¤å¤åœ°ä¿®æ”¹å’ŒæŽ¨æ•²ä»£ç ã€‚ å†™ä¼˜é›…çš„ä»£ç  ä¼˜é›…çš„ä»£ç çš„å¦ä¸€ä¸ªç‰¹å¾æ˜¯ï¼Œå®ƒçš„é€»è¾‘å¤§ä½“ä¸Šçœ‹èµ·æ¥ï¼Œæ˜¯æžä¸«åˆ†æ˜Žçš„æ ‘çŠ¶ç»“æž„ï¼ˆtreeï¼‰ã€‚ å†™æ¨¡å—åŒ–çš„ä»£ç ä¸€ä¸ªæ¨¡å—åº”è¯¥åƒä¸€ä¸ªç”µè·¯èŠ¯ç‰‡ï¼Œå®ƒæœ‰å®šä¹‰è‰¯å¥½çš„è¾“å…¥å’Œè¾“å‡ºã€‚å®žé™…ä¸Šä¸€ç§å¾ˆå¥½çš„æ¨¡å—åŒ–æ–¹æ³•æ—©å·²ç»å­˜åœ¨ï¼Œå®ƒçš„åå­—å«åšâ€œå‡½æ•°â€ã€‚æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰æ˜Žç¡®çš„è¾“å…¥ï¼ˆå‚æ•°ï¼‰å’Œè¾“å‡ºï¼ˆè¿”å›žå€¼ï¼‰ï¼ŒåŒä¸€ä¸ªæ–‡ä»¶é‡Œå¯ä»¥åŒ…å«å¤šä¸ªå‡½æ•°ï¼Œæ‰€ä»¥ä½ å…¶å®žæ ¹æœ¬ä¸éœ€è¦æŠŠä»£ç åˆ†å¼€åœ¨å¤šä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•é‡Œé¢ï¼ŒåŒæ ·å¯ä»¥å®Œæˆä»£ç çš„æ¨¡å—åŒ–ã€‚æˆ‘å¯ä»¥æŠŠä»£ç å…¨éƒ½å†™åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå´ä»ç„¶æ˜¯éžå¸¸æ¨¡å—åŒ–çš„ä»£ç ã€‚æƒ³è¦è¾¾åˆ°å¾ˆå¥½çš„æ¨¡å—åŒ–ï¼Œä½ éœ€è¦åšåˆ°ä»¥ä¸‹å‡ ç‚¹ï¼š é¿å…å†™å¤ªé•¿çš„å‡½æ•°ï¼› åˆ¶é€ å°çš„å·¥å…·å‡½æ•°ï¼› æ¯ä¸ªå‡½æ•°åªåšä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼›ä¸¾ä¸ªðŸŒ°ï¼šæ¯”å¦‚æŸäº›äººå–œæ¬¢å†™â€œé€šç”¨â€å‡½æ•°ï¼š void foo() { if (getOS().equals(&quot;MacOS&quot;)) { a(); } else { b(); } c(); if (getOS().equals(&quot;MacOS&quot;)) { d(); } else { e(); } } è¿™ç§â€œå¤ç”¨â€å…¶å®žæ˜¯æœ‰å®³çš„ã€‚å¦‚æžœä¸€ä¸ªå‡½æ•°å¯èƒ½åšä¸¤ç§äº‹æƒ…ï¼Œå®ƒä»¬ä¹‹é—´å…±åŒç‚¹å°‘äºŽå®ƒä»¬çš„ä¸åŒç‚¹ï¼Œé‚£ä½ æœ€å¥½å°±å†™ä¸¤ä¸ªä¸åŒçš„å‡½æ•°ï¼Œå¦åˆ™è¿™ä¸ªå‡½æ•°çš„é€»è¾‘å°±ä¸ä¼šå¾ˆæ¸…æ™°ï¼Œå®¹æ˜“å‡ºçŽ°é”™è¯¯ã€‚å…¶å®žï¼Œä¸Šé¢è¿™ä¸ªå‡½æ•°å¯ä»¥æ”¹å†™æˆä¸¤ä¸ªå‡½æ•°ï¼š void fooMacOS() { a(); c(); d(); } å’Œ void fooOther() { b(); c(); e(); } å¦‚æžœä½ å‘çŽ°ä¸¤ä»¶äº‹æƒ…å¤§éƒ¨åˆ†å†…å®¹ç›¸åŒï¼Œåªæœ‰å°‘æ•°ä¸åŒï¼Œå¤šåŠæ—¶å€™ä½ å¯ä»¥æŠŠç›¸åŒçš„éƒ¨åˆ†æå–å‡ºåŽ»ï¼Œåšæˆä¸€ä¸ªè¾…åŠ©å‡½æ•°ã€‚æ¯”å¦‚ï¼Œå¦‚æžœä½ æœ‰ä¸ªå‡½æ•°æ˜¯è¿™æ ·ï¼š void foo() { a(); b() c(); if (getOS().equals(&quot;MacOS&quot;)) { d(); } else { e(); } } å…¶ä¸­a()ï¼Œb()ï¼Œc()éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰d()å’Œe()æ ¹æ®ç³»ç»Ÿæœ‰æ‰€ä¸åŒã€‚é‚£ä¹ˆä½ å¯ä»¥æŠŠa()ï¼Œb()ï¼Œc()æå–å‡ºåŽ»ï¼š void preFoo() { a(); b() c(); ç„¶åŽåˆ¶é€ ä¸¤ä¸ªå‡½æ•°ï¼š void fooMacOS() { preFoo(); d(); } å’Œ void fooOther() { preFoo(); e(); } é¿å…ä½¿ç”¨å…¨å±€å˜é‡å’Œç±»æˆå‘˜æ¥ä¼ é€’ä¿¡æ¯ï¼Œå°½é‡æ˜¯ç”¨å±€éƒ¨å˜é‡å’Œå‚æ•°ï¼› å†™å¯è¯»çš„ä»£ç æ³¨é‡Šä¸ä½†æ²¡èƒ½è®©ä»£ç å˜å¾—å¯è¯»ï¼Œåè€Œç”±äºŽå¤§é‡çš„æ³¨é‡Šå……æ–¥åœ¨ä»£ç ä¸­é—´ï¼Œè®©ç¨‹åºå˜å¾—éšœçœ¼éš¾è¯»ã€‚è€Œä¸”ä»£ç çš„é€»è¾‘ä¸€æ—¦ä¿®æ”¹ï¼Œå°±ä¼šæœ‰å¾ˆå¤šçš„æ³¨é‡Šå˜å¾—è¿‡æ—¶ï¼Œéœ€è¦æ›´æ–°ã€‚ä¿®æ”¹æ³¨é‡Šæ˜¯ç›¸å½“å¤§çš„è´Ÿæ‹…ï¼Œæ‰€ä»¥å¤§é‡çš„æ³¨é‡Šï¼Œåè€Œæˆä¸ºäº†å¦¨ç¢æ”¹è¿›ä»£ç çš„ç»Šè„šçŸ³ã€‚å®žé™…ä¸Šï¼ŒçœŸæ­£ä¼˜é›…å¯è¯»çš„ä»£ç ï¼Œæ˜¯å‡ ä¹Žä¸éœ€è¦æ³¨é‡Šçš„ã€‚å¦‚æžœæ²¡èƒ½åˆç†åˆ©ç”¨ç¨‹åºè¯­è¨€æä¾›çš„ä¼˜åŠ¿ï¼Œä½ ä¼šå‘çŽ°ç¨‹åºè¿˜æ˜¯å¾ˆéš¾æ‡‚ï¼Œä»¥è‡³äºŽéœ€è¦å†™æ³¨é‡Šã€‚æ‰€ä»¥æˆ‘çŽ°åœ¨å‘Šè¯‰ä½ ä¸€äº›è¦ç‚¹ï¼Œä¹Ÿè®¸å¯ä»¥å¸®åŠ©ä½ å¤§å¤§å‡å°‘å†™æ³¨é‡Šçš„å¿…è¦ï¼š ä½¿ç”¨æœ‰æ„ä¹‰çš„å‡½æ•°å’Œå˜é‡åå­—ï¼› å±€éƒ¨å˜é‡åº”è¯¥å°½é‡æŽ¥è¿‘ä½¿ç”¨å®ƒçš„åœ°æ–¹ï¼› å±€éƒ¨å˜é‡åå­—åº”è¯¥ç®€çŸ­ï¼› ä¸è¦é‡ç”¨å±€éƒ¨å˜é‡ï¼› æŠŠå¤æ‚çš„é€»è¾‘æå–å‡ºåŽ»ï¼Œåšæˆâ€œå¸®åŠ©å‡½æ•°â€ï¼› æŠŠå¤æ‚çš„è¡¨è¾¾å¼æå–å‡ºåŽ»ï¼Œåšæˆä¸­é—´å˜é‡ï¼› åœ¨åˆç†çš„åœ°æ–¹æ¢è¡Œï¼›ä¸¾ä¸ªðŸŒ°ï¼š if (someLongCondition1() &amp;&amp; someLongCondition2() &amp;&amp; someLongCondition3() &amp;&amp; someLongCondition4()) { ... } è¿™æ ·å½¢å¼çš„è¡¨è¾¾ï¼Œæ›´æ–¹ä¾¿åˆ«äººç†è§£ä»£ç çš„é€»è¾‘ï¼š if (someLongCondition1() &amp;&amp; someLongCondition2() &amp;&amp; someLongCondition3() &amp;&amp; someLongCondition4()) { ... } å†ä¸¾ä¸ªðŸŒ°ï¼š log.info(&quot;failed to find file {} for command {}, with exception {}&quot;, file, command, exception); fileï¼Œcommandå’Œexceptionæœ¬æ¥æ˜¯åŒä¸€ç±»ä¸œè¥¿ï¼Œå´æœ‰ä¸¤ä¸ªç•™åœ¨äº†ç¬¬ä¸€è¡Œï¼Œæœ€åŽä¸€ä¸ªè¢«æŠ˜åˆ°ç¬¬äºŒè¡Œã€‚å®ƒå°±ä¸å¦‚æ‰‹åŠ¨æ¢è¡Œæˆè¿™ä¸ªæ ·å­ï¼š log.info(&quot;failed to find file {} for command {}, with exception {}&quot;, file, command, exception); å†™ç®€å•çš„ä»£ç çŽ°åœ¨é’ˆå¯¹ä¸€äº›æœ‰é—®é¢˜çš„è¯­è¨€ç‰¹æ€§ï¼Œæˆ‘ä»‹ç»ä¸€äº›æˆ‘è‡ªå·±ä½¿ç”¨çš„ä»£ç è§„èŒƒï¼Œå¹¶ä¸”è®²è§£ä¸€ä¸‹ä¸ºä»€ä¹ˆå®ƒä»¬èƒ½è®©ä»£ç æ›´ç®€å•ã€‚ é¿å…ä½¿ç”¨è‡ªå¢žå‡è¡¨è¾¾å¼ï¼ˆi++ï¼Œ++iï¼Œiâ€“ï¼Œâ€“iï¼‰ï¼› æ°¸è¿œä¸è¦çœç•¥èŠ±æ‹¬å·ï¼› åˆç†ä½¿ç”¨æ‹¬å·ï¼Œä¸è¦ç›²ç›®ä¾èµ–æ“ä½œç¬¦ä¼˜å…ˆçº§ï¼› é¿å…ä½¿ç”¨continueå’Œbreakï¼š å¦‚æžœå‡ºçŽ°äº†continueï¼Œä½ å¾€å¾€åªéœ€è¦æŠŠcontinueçš„æ¡ä»¶åå‘ï¼Œå°±å¯ä»¥æ¶ˆé™¤continueã€‚ å¦‚æžœå‡ºçŽ°äº†breakï¼Œä½ å¾€å¾€å¯ä»¥æŠŠbreakçš„æ¡ä»¶ï¼Œåˆå¹¶åˆ°å¾ªçŽ¯å¤´éƒ¨çš„ç»ˆæ­¢æ¡ä»¶é‡Œï¼Œä»Žè€ŒåŽ»æŽ‰breakã€‚ æœ‰æ—¶å€™ä½ å¯ä»¥æŠŠbreakæ›¿æ¢æˆreturnï¼Œä»Žè€ŒåŽ»æŽ‰breakã€‚ å¦‚æžœä»¥ä¸Šéƒ½å¤±è´¥äº†ï¼Œä½ ä¹Ÿè®¸å¯ä»¥æŠŠå¾ªçŽ¯é‡Œé¢å¤æ‚çš„éƒ¨åˆ†æå–å‡ºæ¥ï¼Œåšæˆå‡½æ•°è°ƒç”¨ï¼Œä¹‹åŽcontinueæˆ–è€…breakå°±å¯ä»¥åŽ»æŽ‰äº†ã€‚ å†™ç›´è§‚çš„ä»£ç æˆ‘å†™ä»£ç æœ‰ä¸€æ¡é‡è¦çš„åŽŸåˆ™ï¼šå¦‚æžœæœ‰æ›´åŠ ç›´æŽ¥ï¼Œæ›´åŠ æ¸…æ™°çš„å†™æ³•ï¼Œå°±é€‰æ‹©å®ƒï¼Œå³ä½¿å®ƒçœ‹èµ·æ¥æ›´é•¿ï¼Œæ›´ç¬¨ï¼Œä¹Ÿä¸€æ ·é€‰æ‹©å®ƒã€‚ if (action1() || action2() &amp;&amp; action3()) { ... } ï¼ã€‹ if (!action1()) { if (action2()) { action3(); } } å†™æ— æ‡ˆå¯å‡»çš„ä»£ç if (...) { if (...) { ... return false; } else { return true; } } else if (...) { ... return false; } else { return true; } ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå…¶å®žæ˜¯ä¸ºäº†æ— æ‡ˆå¯å‡»çš„å¤„ç†æ‰€æœ‰å¯èƒ½å‡ºçŽ°çš„æƒ…å†µï¼Œé¿å…æ¼æŽ‰corner caseã€‚æ¯ä¸ªifè¯­å¥éƒ½æœ‰ä¸¤ä¸ªåˆ†æ”¯çš„ç†ç”±æ˜¯ï¼šå¦‚æžœifçš„æ¡ä»¶æˆç«‹ï¼Œä½ åšæŸä»¶äº‹æƒ…ï¼›ä½†æ˜¯å¦‚æžœifçš„æ¡ä»¶ä¸æˆç«‹ï¼Œä½ åº”è¯¥çŸ¥é“è¦åšä»€ä¹ˆå¦å¤–çš„äº‹æƒ…ã€‚ä¸ç®¡ä½ çš„ifæœ‰æ²¡æœ‰elseï¼Œä½ ç»ˆç©¶æ˜¯é€ƒä¸æŽ‰ï¼Œå¿…é¡»å¾—æ€è€ƒè¿™ä¸ªé—®é¢˜çš„ã€‚ æ­£ç¡®å¤„ç†é”™è¯¯try { ... } catché‡Œé¢ï¼Œåº”è¯¥åŒ…å«å°½é‡å°‘çš„ä»£ç ã€‚æ¯”å¦‚ï¼Œå¦‚æžœfooå’Œbaréƒ½å¯èƒ½äº§ç”Ÿå¼‚å¸¸Aï¼Œä½ çš„ä»£ç åº”è¯¥å°½å¯èƒ½å†™æˆï¼š try { foo(); } catch (A e) {...} try { bar(); } catch (A e) {...} ï¼ã€‹ try { foo(); bar(); } catch (A e) {...} æ­£ç¡®å¤„ç†nullæŒ‡é’ˆè¿™äº›è¯­è¨€çš„ç±»åž‹ç³»ç»Ÿå…è®¸nullå‡ºçŽ°åœ¨ä»»ä½•å¯¹è±¡ï¼ˆæŒ‡é’ˆï¼‰ç±»åž‹å¯ä»¥å‡ºçŽ°çš„åœ°æ–¹ï¼Œç„¶è€Œnullå…¶å®žæ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„å¯¹è±¡ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªStringï¼Œä¸æ˜¯ä¸€ä¸ªIntegerï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»ã€‚nullçš„ç±»åž‹æœ¬æ¥åº”è¯¥æ˜¯NULLï¼Œä¹Ÿå°±æ˜¯nullè‡ªå·±ã€‚æ ¹æ®è¿™ä¸ªåŸºæœ¬è§‚ç‚¹ï¼Œæˆ‘ä»¬æŽ¨å¯¼å‡ºä»¥ä¸‹åŽŸåˆ™ï¼š å°½é‡ä¸è¦äº§ç”ŸnullæŒ‡é’ˆï¼› ä¸è¦catch NullPointerExceptionï¼› ä¸è¦æŠŠnullæ”¾è¿›â€œå®¹å™¨æ•°æ®ç»“æž„â€é‡Œé¢ï¼› å‡½æ•°è°ƒç”¨è€…ï¼šæ˜Žç¡®ç†è§£nullæ‰€è¡¨ç¤ºçš„æ„ä¹‰ï¼Œå°½æ—©æ£€æŸ¥å’Œå¤„ç†nullè¿”å›žå€¼ï¼Œå‡å°‘å®ƒçš„ä¼ æ’­ï¼› å‡½æ•°ä½œè€…ï¼šæ˜Žç¡®å£°æ˜Žä¸æŽ¥å—nullå‚æ•°ï¼Œå½“å‚æ•°æ˜¯nullæ—¶ç«‹å³å´©æºƒï¼› ä½¿ç”¨@NotNullå’Œ@Nullableæ ‡è®°ï¼› ä½¿ç”¨Optionalç±»åž‹ é˜²æ­¢è¿‡åº¦å·¥ç¨‹æˆ‘æ€»ç»“å‡ºæ¥çš„é˜²æ­¢è¿‡åº¦å·¥ç¨‹çš„åŽŸåˆ™å¦‚ä¸‹ï¼š å…ˆæŠŠçœ¼å‰çš„é—®é¢˜è§£å†³æŽ‰ï¼Œè§£å†³å¥½ï¼Œå†è€ƒè™‘å°†æ¥çš„æ‰©å±•é—®é¢˜ï¼› å…ˆå†™å‡ºå¯ç”¨çš„ä»£ç ï¼Œåå¤æŽ¨æ•²ï¼Œå†è€ƒè™‘æ˜¯å¦éœ€è¦é‡ç”¨çš„é—®é¢˜ï¼› å…ˆå†™å‡ºå¯ç”¨ï¼Œç®€å•ï¼Œæ˜Žæ˜¾æ²¡æœ‰bugçš„ä»£ç ï¼Œå†è€ƒè™‘æµ‹è¯•çš„é—®é¢˜ã€‚ åŽŸæ–‡åœ°å€]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[NSDate]]></title>
      <url>%2F2017%2F05%2F14%2FNSDate%2F</url>
      <content type="text"><![CDATA[NSDateNSDate åˆå§‹åŒ–èŽ·å–çš„æ—¶é—´ä¸Žäº‹å®žç›¸å·®8å°æ—¶NSDate *date = [NSDate date]; NSLog(@&quot;Date : %@&quot;, date); //2017-05-14 16:59:03 NSDateDemoDate : 2017-05-14 08:59:03 +0000 åŽŸå› æ˜¯ä»–èŽ·å–çš„æ˜¯é›¶æ—¶åŒºçš„æ—¶é—´ï¼Œè€Œæˆ‘å¤§å¤©æœåœ¨ä¸œå…«åŒºï¼Œæ‰€ä»¥æœ‰å…«ä¸ªå°æ—¶çš„æ—¶å·®ï¼Solution: NSTimeZone *zone = [NSTimeZone systemTimeZone]; NSTimeInterval timeInterval = [zone secondsFromGMTForDate:date]; NSDate *localDate = [date dateByAddingTimeInterval:timeInterval]; NSLog(@&quot;Local Date: %@&quot;,localDate); //2017-05-14 16:59:03 NSDateDemo Local Date: 2017-05-14 16:59:03 +0000 å€ŸåŠ© NSDateFormatter å®žçŽ°NSDate \&lt;-> NSStringNSDate -> NSStringNSDateFormatter *dateformatter = [[NSDateFormatter alloc]init]; [dateformatter setDateFormat:@&quot;YYYY/MM/dd HH:mm:ss&quot;]; NSString *dateStr = [dateformatter stringFromDate:date]; NSLog(@&quot;dateString : %@&quot;,dateStr); dateçš„æ—¶é—´æ˜¯2017-05-14 09:22:56 è€ŒdateStræ‰“å°å‡ºæ¥å´æ˜¯ 2017/05/14 17:22:56 è‡ªåŠ¨å¸®ä½ åŠ äº†8å°æ—¶ï¼Œæ˜¯å› ä¸ºdateformatter.timeZone é»˜è®¤è®¾ç½®æˆäº† Asia/Shanghai (GMT+8) offset 28800 è‡³äºŽèœœæ±ç¬¦å·YYYY/MM/dd HH:mm:sså¯ä»¥å‚è€ƒè¯´æ˜Žç¬¦å·æ–‡æ¡£ï¼› NSString -> NSDateNSDate *date1 = [dateformatter dateFromString:dateStr]; NSLog(@&quot;date1 : %@&quot;,date1); NSDate Comparison- (NSDate *)earlierDate:(NSDate *)anotherDate; - (NSDate *)laterDate:(NSDate *)anotherDate; - (NSComparisonResult)compare:(NSDate *)other; - (BOOL)isEqualToDate:(NSDate *)otherDate; NSComparisonResult ï¼š typedef NS_ENUM(NSInteger, NSComparisonResult) {_ NSOrderedAscending = -1L, NSOrderedSame, NSOrderedDescending }; NSDateComponentsNSDateComponents å’ŒNSCalendar æ­é…ä½¿ç”¨ï¼š NSCalendar *calendar = [[NSCalendar alloc]initWithCalendarIdentifier:NSCalendarIdentifierGregorian]; NSDateComponents *components = [calendar components:NSCalendarUnitDay|NSCalendarUnitYear|NSCalendarUnitMonth fromDate:[NSDate date]]; NSLog(@&quot;%@&quot;,components); logç»“æžœ Calendar Year: 2017 Month: 5 Leap month: no Day: 14 Tips:è®¡ç®—ä¸¤ä¸ªæ—¶é—´ç›¸å·®å¤šå°‘å¤©ï¼š NSDateComponents *components = [calendar components:NSCalendarUnitDay fromDate:dateTemp toDate:nowDate options:NSCalendarWrapComponents]; æœ€åŽå…³äºŽNSDateçš„ä¿¡æ¯ç•¥åºžå¤§ï¼ŒåŽç»­æ‰¾ä¸ªæ—¶é—´æ¥å¡«å‘ï¼ŒåŒæ—¶åœ¨åšè¿™ä»½ç¬”è®°ðŸ“’çš„æ—¶å€™ï¼Œæ— æ„ä¸­æ‰¾åˆ°ä¸€ä»½æ¯”è¾ƒå…¨é¢èµ„æ–™A Beginnerâ€™s Guide to NSDate in Swiftï¼Œé»˜é»˜æ”¶è—ä¸‹ï¼]]></content>
    </entry>

    
    <entry>
      <title><![CDATA[Block ç¬”è®°]]></title>
      <url>%2F2017%2F04%2F23%2FBlock-%E7%AC%94%E8%AE%B0%2F</url>
      <content type="text"><![CDATA[BlockåŸºç¡€çš„çŸ¥è¯†blockæ˜¯Cã€C++ ã€OC çš„closureã€‚ block æ˜¯åœ¨æ ˆä¸Šåˆ›å»ºçš„ï¼› block å¯ä»¥å¤åˆ¶åˆ°å †ä¸Šï¼› Block çš„å¼ºå¤§ä¹‹å¤„ï¼šä¼šæ•èŽ·æ ˆä¸Šçš„å˜é‡(æˆ–æŒ‡é’ˆ)ï¼Œå°†å…¶å¤åˆ¶ä¸ºè‡ªå·±ç§æœ‰çš„const(å˜é‡)ï¼› (å¦‚æžœåœ¨Blockä¸­ä¿®æ”¹Blockå—å¤–çš„)æ ˆä¸Šçš„å˜é‡å’ŒæŒ‡é’ˆï¼Œé‚£ä¹ˆè¿™äº›å˜é‡å’ŒæŒ‡é’ˆå¿…é¡»ç”¨__blockå…³é”®å­—ç”³æ˜Ž(å¦åˆ™å°±ä¼šè·Ÿä¸Šé¢çš„æƒ…å†µä¸€æ ·åªæ˜¯æ•èŽ·ä»–ä»¬çš„çž¬æ—¶å€¼)ã€‚ blockçš„ä½¿ç”¨blockç±»åž‹çš„è¯­æ³•ç»“æž„å¦‚ä¸‹ï¼šreturn_type (^block_name)(arguments) ä¸¾ä¸ªðŸŒ°ï¼š int (^addBlock)(int a, int b) = ^(int a, int b){ return a + b; } ä¸ºå¸¸ç”¨çš„blockç±»åž‹åˆ›å»ºtypedeftypedef return_type(^name)(arguments); ç”¨æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„â€œcompletion handlerâ€æ¥ä¸¾ä¸ªðŸŒ°ï¼š typedef void(^EOCCompletionHandler) (NSData *data, NSError *error); - (void)startWithCompletionHandle:(EOCCompletionHandler)completion; blockçš„å‘½åæœ€å¥½æ˜¯ï¼šç±»å + blockçš„åŠŸèƒ½ + CompletionHandleï¼› æ¥ä¸ªðŸŒ°ï¼š typedef void(^ACAccountStoreSaveCompetionHandle) (BOOL success, NSError *error); å°ç»“ï¼štypedef å¯ä»¥ä½¿blockä½¿ç”¨èµ·æ¥æ›´åŠ ç®€å•ï¼Œå¦‚æžœè¦refactorä»£ç çš„æ—¶å€™ï¼Œåªéœ€ä¿®æ”¹typedefä¸­blockçš„nameå³å¯ï¼› blockçš„retain cycleå½“ä½¿ç”¨ä»£ç å—å’Œå¼‚æ­¥åˆ†å‘çš„æ—¶å€™ï¼Œè¦æ³¨æ„é¿å…å¼•ç”¨å¾ªçŽ¯ã€‚ æ€Žä¹ˆå¼•èµ·å¾ªçŽ¯å¼•ç”¨çš„å‘¢ï¼Ÿä¸¾ä¸ªðŸŒ°ï¼š self.completionHandler = ^{ NSLog(@&quot;%@&quot;, self); } MyViewController *myController = [[MyViewController alloc] init...]; [self presentViewController:myController animated:YES completion:self.completionHandler]; Retain Cycle ï¼šselfé€šè¿‡å±žæ€§æŒæœ‰blockï¼ŒblockæŒæœ‰selfï¼Œå°±å½¢æˆäº†å¾ªçŽ¯å¼•ç”¨ã€‚(self -ã€‹block -ã€‹self) é¿å…blockæ–¹æ³•åŠå·®å¼‚ï¼š åœ¨ block å¤–å®šä¹‰ä¸€ä¸ª __weak çš„å¼•ç”¨åˆ° selfï¼Œå¹¶ä¸”åœ¨ block é‡Œé¢ä½¿ç”¨è¿™ä¸ªå¼±å¼•ç”¨ï¼› åœ¨ block å¤–å®šä¹‰ä¸€ä¸ª __weak çš„ å¼•ç”¨åˆ° selfï¼Œå¹¶åœ¨åœ¨ block å†…éƒ¨é€šè¿‡è¿™ä¸ªå¼±å¼•ç”¨å®šä¹‰ä¸€ä¸ª __strong çš„å¼•ç”¨ï¼›æ–¹æ¡ˆ 1ï¼šåœ¨ block å¤–å®šä¹‰ä¸€ä¸ª __weak çš„ å¼•ç”¨åˆ° selfï¼Œå¹¶ä¸”åœ¨ block é‡Œé¢ä½¿ç”¨è¿™ä¸ªå¼±å¼•ç”¨ï¼š __weak typeof(self) weakSelf = self; self.completionHandler = ^{ NSLog(@&quot;%@&quot;, weakSelf); }; MyViewController *myController = [[MyViewController alloc] init...]; [self presentViewController:myController animated:YES completion:self.completionHandler]; æ–¹æ¡ˆ 2ï¼š åœ¨ block å¤–å®šä¹‰ä¸€ä¸ª __weak çš„ å¼•ç”¨åˆ° selfï¼Œå¹¶åœ¨åœ¨ block å†…éƒ¨é€šè¿‡è¿™ä¸ªå¼±å¼•ç”¨å®šä¹‰ä¸€ä¸ª __strong çš„å¼•ç”¨ã€‚ ä¸ç®¡ block æ˜¯å¦é€šè¿‡å±žæ€§è¢« retain ï¼Œè¿™é‡Œä¹Ÿä¸ä¼šå‘ç”Ÿå¾ªçŽ¯å¼•ç”¨ã€‚å¦‚æžœ block è¢«ä¼ é€’åˆ°å…¶ä»–å¯¹è±¡å¹¶ä¸”è¢«å¤åˆ¶äº†ï¼Œæ‰§è¡Œçš„æ—¶å€™ï¼ŒweakSelf å¯èƒ½è¢«nilï¼Œå› ä¸ºå¼ºå¼•ç”¨è¢«èµ‹å€¼å¹¶ä¸”ä¸ä¼šå˜æˆnilçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç¡®ä¿å¯¹è±¡ åœ¨ block è°ƒç”¨çš„å®Œæ•´å‘¨æœŸé‡Œé¢è¢« retainäº†ï¼Œå¦‚æžœæŠ¢å å‘ç”Ÿäº†ï¼ŒéšåŽçš„å¯¹ strongSelf çš„æ‰§è¡Œä¼šç»§ç»­å¹¶ä¸”ä¼šäº§ç”Ÿä¸€æ ·çš„å€¼ã€‚å¦‚æžœ strongSelf çš„æ‰§è¡Œåˆ° nilï¼Œé‚£ä¹ˆåœ¨ block ä¸èƒ½æ­£ç¡®æ‰§è¡Œå‰å·²ç»è¿”å›žäº†ã€‚ __weak typeof(self) weakSelf = self; myObj.myBlock = ^{ __strong typeof(self) strongSelf = weakSelf; if (strongSelf) { [strongSelf doSomething]; // strongSelf != nil // preemption, strongSelf still not nilï¼ˆæŠ¢å çš„æ—¶å€™ï¼ŒstrongSelf è¿˜æ˜¯éž nil çš„) [strongSelf doSomethingElse]; // strongSelf != nil }else { // Probably nothing... return; } }; å°ç»“ï¼šæ–¹æ¡ˆ 1: å½“ block è¢«å£°æ˜Žä¸ºä¸€ä¸ª property çš„æ—¶å€™ä½¿ç”¨ã€‚æ–¹æ¡ˆ 2: å’Œå¹¶å‘æ‰§è¡Œæœ‰å…³ã€‚å½“æ¶‰åŠå¼‚æ­¥çš„æœåŠ¡çš„æ—¶å€™ï¼Œblock å¯ä»¥åœ¨ä¹‹åŽè¢«æ‰§è¡Œï¼Œå¹¶ä¸”ä¸ä¼šå‘ç”Ÿå…³äºŽ self æ˜¯å¦å­˜åœ¨çš„é—®é¢˜ å¯¹è±¡ä¹‹é—´çš„ä¿¡æ¯ä¼ é€’çš„ðŸŒ°åšäº†ä¸ªDemoï¼Œåœ¨ä¸¤ä¸ªViewControllerä¹‹é—´è¿›è¡Œä¿¡æ¯çš„ä¼ é€’ï¼ŒViewControllerä¸­è®¾ç½®ä¸ªlabelï¼Œå±•ç¤ºä¿¡æ¯ï¼Œè€ŒNextViewControllerä¸­çš„textfieldä¸­è¾“å…¥è¦ä¼ é€’çš„ä¿¡æ¯stringï¼› NextViewController.h typedef void(^PassTextFieldValueBlock)(NSString *string) @interface NextViewController:ViewController @property (nonatomic,copy) PassTextFieldValueBlock passTextFieldValueBlock; @end ViewController.m -(IBACtion)pushNextViewController:(UIButton *)sender{ NextViewController *nextVC = [[NextViewController alloc]init]; __weak typeof(self) weakSelf = self; nextVC.passTextFieldValueBlock = ^(NSString *string){ //call Reset label method; }; [self.navigationController pushViewController:nextVC anmiated:Yes] } å…·ä½“çš„å®žçŽ°è¿‡ç¨‹å¯ä»¥å‚è€ƒBlockDemo]]></content>
    </entry>

    
  
  
</search>
